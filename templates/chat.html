{% extends "base.html" %}
{% block content %}
<section aria-labelledby="chat-title">
  <h2 id="chat-title">Чат {{ chat_id }}</h2>

  <!-- Аватар чата и кнопка "Назад" -->
  <div class="chat-header">
    <div class="chat-avatar-wrapper">
      <img 
        src="/chat/{{ chat_id }}/avatar?v={{ chat_id }}"
        alt="Аватар чата"
        width="96"
        height="96"
        class="chat-avatar"
        loading="lazy"
        onerror="this.style.display='none'"
      >
    </div>
    <a class="btn btn-secondary" href="/platform">Назад к списку</a>
  </div>

  <!-- История сообщений -->
  <div id="chat-history" class="chat-history" role="log" aria-live="polite" aria-label="История переписки">
    {% if history %}
      {% for m in history %}
        <div class="msg {{ m.role }}" aria-label="{{ 'Пользователь' if m.role == 'user' else 'Космокот' }}: {{ m.content | striptags }}">
          <strong>{{ 'Пользователь' if m.role == 'user' else 'Космокот' }}:</strong>
          {{ m.content }}
        </div>
      {% endfor %}
    {% else %}
      <div class="msg empty">История пуста</div>
    {% endif %}
  </div>

  <!-- Форма отправки сообщения -->
  <form method="post" class="chat-form" novalidate>
    <input 
      type="text"
      name="message"
      id="message-input"
      placeholder="Напишите сообщение..."
      required
      autocomplete="off"
      aria-label="Введите сообщение"
    >
    <button class="btn btn-primary" type="submit">Отправить</button>
  </form>
</section>
{% endblock %}
